{
  "id": "snapshot_1767531121929_yuahne15o",
  "approvalId": "approval_1767531121913_18l41dt63",
  "approvalTitle": "审批需求文档：CommandPalette 与 Switcher 交互增强",
  "version": 1,
  "timestamp": "2026-01-04T12:52:01.929Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document\n\n## Introduction\n\n当前应用的核心交互主要依赖三处入口：\n1) 侧边栏应用切换器（`Switcher`）用于“使用/切换”；2) 全局命令面板（`CommandPalette`）用于“搜索/跳转”；3) 设置抽屉里的应用库视图（`LibraryView`）用于“管理（创建/编辑/删除/分组/固定）”。\n\n现状存在可优化点：`CommandPalette` 目前仅能搜索应用（配置文件），缺少“动作”执行能力；`Switcher` 可拖拽排序但可发现性与反馈偏弱，且缺少就地管理入口（编辑/取消固定/定位到库）；搜索结果缺少匹配高亮，用户需要额外认知成本确认命中项。\n\n本 spec 目标是以最小改动将“使用”与“管理”的关键路径打通：让用户在 `CommandPalette` 和 `Switcher` 两个高频入口完成更多高频动作，并通过清晰反馈减少误操作喵～\n\n## Alignment with Product Vision\n\n该优化与 Portal Kit 的产品目标一致：以更少的步骤完成“找到应用 → 切换/执行动作 → 必要时快速管理配置”，降低上下文切换成本，提高可发现性与可用性，同时保持界面简洁（KISS）与功能克制（YAGNI）喵～\n\n## Requirements\n\n### Requirement 1: 增强 CommandPalette 为“命令面板”\n\n**User Story:** 作为日常用户，我希望在 `CommandPalette` 中不仅能搜索应用，还能搜索并执行常用动作，这样我可以更快完成操作并减少去设置页查找入口的次数。\n\n#### Acceptance Criteria\n\n1. WHEN `CommandPalette` 打开并输入查询词 THEN 系统 SHALL 同时返回“应用（Profiles）”与“命令（Commands）”两类结果（可分组展示或统一列表展示，但需可区分类型）。\n2. WHEN 用户使用 `↑/↓` 与 `Enter` 操作结果 THEN 系统 SHALL 支持在全部结果中顺序导航并执行选中项。\n3. WHEN 用户选择一个命令项 THEN 系统 SHALL 执行对应动作并按既定策略关闭面板（默认关闭）。\n4. IF 命令执行失败 THEN 系统 SHALL 给出非阻塞的失败反馈（例如 toast/提示文案），且不影响后续继续使用。\n\n### Requirement 2: CommandPalette 支持“创建应用”快捷入口\n\n**User Story:** 作为经常添加新站点的用户，我希望在搜索无结果时能直接创建新的应用配置，这样我可以把“搜索 → 创建 → 使用”的路径缩短为一次操作。\n\n#### Acceptance Criteria\n\n1. WHEN 查询词非空且无任何应用结果 THEN 系统 SHALL 展示一个“创建应用”入口（例如“创建应用：{query}”）。\n2. WHEN 用户选择“创建应用”入口 THEN 系统 SHALL 进入最小创建流程：至少要求输入 `startUrl`，并允许以 `query` 作为默认 `name`（可编辑/可取消）。\n3. WHEN 用户确认创建且 `startUrl` 合法 THEN 系统 SHALL 创建新的 Profile，并使其可在 `Switcher` 中可见（默认固定到侧边栏），并可选地自动切换到新建 Profile。\n4. IF `startUrl` 非法或为空 THEN 系统 SHALL 阻止创建并给出明确校验提示。\n\n### Requirement 3: CommandPalette 搜索结果高亮匹配\n\n**User Story:** 作为需要快速确认命中项的用户，我希望搜索结果中能高亮匹配字符，这样我能更快确认“为什么命中”与“命中了哪里”。\n\n#### Acceptance Criteria\n\n1. WHEN 查询词非空 THEN 系统 SHALL 在结果列表中对名称与副文本（如 URL）展示匹配高亮（至少覆盖应用结果；命令结果可复用同一高亮逻辑）。\n2. WHEN 使用模糊匹配（非连续字符） THEN 系统 SHALL 尽可能高亮匹配到的字符序列；若无法计算精确位置 THEN 系统 SHALL 至少对连续子串命中进行高亮。\n3. WHEN 查询词变化 THEN 系统 SHALL 在不引入可感知卡顿的情况下更新高亮与排序。\n\n### Requirement 4: Switcher 提供上下文菜单以提升可发现性\n\n**User Story:** 作为日常用户，我希望在 `Switcher` 的应用图标上通过右键即可进行常用管理操作，这样我不必切换到 `LibraryView` 才能完成编辑/取消固定/定位等动作。\n\n#### Acceptance Criteria\n\n1. WHEN 用户在 `Switcher` 的某个应用图标上触发右键菜单 THEN 系统 SHALL 展示上下文菜单，并包含至少以下动作：`编辑`、`固定/取消固定`、`在库中显示`。\n2. WHEN 用户选择 `编辑` THEN 系统 SHALL 打开设置抽屉，并直接进入该 Profile 的编辑界面。\n3. WHEN 用户选择 `在库中显示` THEN 系统 SHALL 打开设置抽屉，并在 `LibraryView` 列表中滚动定位并高亮该 Profile。\n4. WHEN 用户选择 `固定/取消固定` THEN 系统 SHALL 更新该 Profile 的固定状态并即时反映到 `Switcher`。\n5. WHEN 用户按下 `Escape` 或点击菜单外区域 THEN 系统 SHALL 关闭上下文菜单且不触发切换应用的点击行为。\n\n### Requirement 5: Switcher 拖拽排序的可发现性与反馈增强\n\n**User Story:** 作为新用户，我希望一眼能看出 `Switcher` 支持拖拽排序，并在拖拽过程中得到明确反馈，这样我能更自信地进行排序而不担心误操作。\n\n#### Acceptance Criteria\n\n1. WHEN 用户悬停在可拖拽的应用图标上 THEN 系统 SHALL 提供明确但克制的可拖拽提示（例如拖拽手柄/轻提示/悬停态变化）。\n2. WHEN 用户开始拖拽 THEN 系统 SHALL 提示“正在拖拽”的视觉状态，并对有效落点给出清晰反馈（例如高亮、插入指示线等）。\n3. WHEN 用户完成拖拽并放下 THEN 系统 SHALL 持久化新的顺序，并避免由于拖拽导致的误触切换。\n\n### Requirement 6: LibraryView 提供跨入口的“定位/编辑”承接能力\n\n**User Story:** 作为需要管理应用配置的用户，我希望从 `Switcher`/`CommandPalette` 触发的“编辑/定位”能直接落到 `LibraryView` 的正确位置，这样我能更快完成配置修改。\n\n#### Acceptance Criteria\n\n1. WHEN 设置抽屉以指定 `profileId` 打开并请求 `edit` 模式 THEN 系统 SHALL 打开 `LibraryView` 并进入对应 Profile 的编辑界面。\n2. WHEN 设置抽屉以指定 `profileId` 打开并请求 `reveal` 模式 THEN 系统 SHALL 打开 `LibraryView` 列表并滚动定位/高亮该 Profile。\n3. IF `profileId` 不存在 THEN 系统 SHALL 回退到 `LibraryView` 列表页并给出非阻塞提示。\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n- **Single Responsibility Principle**: 命令注册、命令过滤/排序/高亮、上下文菜单渲染、LibraryView 导航承接应拆分为职责清晰的模块\n- **Modular Design**: 避免把“命令定义 + UI 渲染 + IPC 调用”全部堆在一个组件文件内\n- **Dependency Management**: 尽量复用现有 IPC 与 Profile CRUD 能力，避免新增不必要依赖\n- **Clear Interfaces**: 对外暴露稳定的“命令描述结构”和“导航请求结构”，便于扩展但不提前过度设计\n\n### Performance\n- 在 500 个 Profiles 规模下，`CommandPalette` 过滤与高亮渲染应保持流畅（键入到 UI 更新目标 < 50ms）\n- 上下文菜单打开/关闭应无明显掉帧（目标 < 16ms 内响应）\n\n### Security\n- 新增的 IPC 通道（若需要）必须进行输入校验（如 `profileId`、`mode` 等），避免任意指令执行\n- “创建应用”必须校验 URL，避免写入无效数据导致后续加载异常\n\n### Reliability\n- 任何命令/菜单动作失败不应导致应用崩溃；需给出可理解的失败反馈\n- 拖拽排序与点击切换需互斥处理，避免误切换造成状态丢失错觉\n\n### Usability\n- `CommandPalette` 与 `Switcher` 的新增交互需支持键盘操作与可访问性标注（ARIA）\n- 反馈信息应清晰、非打断（例如轻提示/徽标/高亮），避免弹窗打扰\n",
  "fileStats": {
    "size": 7821,
    "lines": 105,
    "lastModified": "2026-01-04T12:51:37.276Z"
  },
  "comments": []
}